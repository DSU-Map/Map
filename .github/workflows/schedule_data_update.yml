name: ğŸ—“ï¸ Scheduled Data Update (Menu OCR)

on:
  # ë§¤ì¼ ìƒˆë²½ 2ì‹œ (UTC)ì— ì‹¤í–‰ë˜ë„ë¡ ì˜ˆì•½ ì„¤ì • (KST ê¸°ì¤€ ì˜¤ì „ 11ì‹œ)
  schedule:
    - cron: '0 2 * * *'
  # ìˆ˜ë™ ì‹¤í–‰ì„ ìœ„í•œ ì›Œí¬í”Œë¡œìš° ë””ìŠ¤íŒ¨ì¹˜ ì¶”ê°€
  workflow_dispatch:

jobs:
  run_python_script:
    runs-on: ubuntu-latest

    steps:
    - name: 1. ì½”ë“œ ì²´í¬ì•„ì›ƒ (ê²½ë¡œ ê³ ì •)
      uses: actions/checkout@v4
      with:
        # âœ… ì €ì¥ì†Œ ì½”ë“œë¥¼ 'DSUMAP_ROOT' í´ë”ì— ë‹¤ìš´ë¡œë“œ
        path: 'DSUMAP_ROOT' 
        token: ${{ secrets.GITHUB_TOKEN }} 
        
    - name: 2. íŒŒì´ì¬ í™˜ê²½ ì„¤ì •
      uses: actions/setup-python@v5
      with:
        python-version: '3.11' 
        
    - name: 3. í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
      run: |
        pip install google-genai pillow
        
    - name: 4. íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ë° JSON ìƒì„±
      run: |
        # âœ… 'DSUMAP_ROOT' í´ë”ë¡œ ì´ë™ í›„, ìƒëŒ€ ê²½ë¡œë¡œ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
        cd DSUMAP_ROOT
        python backend/ocr_importer_local.py
      env:
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }} 
        
    - name: 5. ë³€ê²½ëœ JSON íŒŒì¼ ì»¤ë°‹ ë° í‘¸ì‹œ
      run: |
        # CWDê°€ DSUMAP_ROOTë¡œ ë³€ê²½ë˜ì—ˆë”ë¼ë„ git ëª…ë ¹ì–´ëŠ” ë£¨íŠ¸ì—ì„œ ì‹¤í–‰ ê°€ëŠ¥í•˜ë¯€ë¡œ ì ˆëŒ€ ê²½ë¡œë¥¼ ì‚¬ìš©
        git config user.name "github-actions[bot]"
        git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
        git add DSUMAP_ROOT/Map/Public/menu_data.json
        git commit -m "chore(data): ìë™ ìŠ¤ì¼€ì¤„ë§ëœ ì‹ë‹¨ ë°ì´í„° ì—…ë°ì´íŠ¸ [skip ci]" || echo "ë³€ê²½ ì‚¬í•­ ì—†ìŒ"
        git push

name: ğŸ—“ï¸ Update Menu Data (Final)

on:
  workflow_dispatch:
  push:
    paths:
      - 'backend/**' # backend í´ë” ë‚´ ëª¨ë“  íŒŒì¼ ë³€ê²½ ì‹œ íŠ¸ë¦¬ê±°
  schedule:
    - cron: "0 2 * * *" # UTC 02:00

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      # 1. ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
      - name: 1. Checkout repository
        uses: actions/checkout@v4
        # âœ… path ì„¤ì • ì œê±°

      # 2. Python í™˜ê²½ ì„¤ì •
      - name: 2. Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      # 3. í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
      - name: 3. Install Dependencies
        # âœ… CWDê°€ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì´ë¯€ë¡œ ë°”ë¡œ pip install
        run: pip install google-genai pillow

      # 4. ğŸš€ OCR ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (ìµœì¢… ë‹¨ìˆœ ê²½ë¡œ)
      - name: 4. Run OCR script
        run: |
          # âœ… CWDê°€ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì´ë¯€ë¡œ Map/ í´ë”ë¥¼ ëª…ì‹œí•˜ê³  ì‹¤í–‰í•©ë‹ˆë‹¤.
          python Map/backend/ocr_importer_local.py
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}

      # 5. ë³€ê²½ëœ JSON íŒŒì¼ ì»¤ë°‹ ë° í‘¸ì‹œ
      - name: 5. Commit & Push JSON update
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@github.com"
          
          # âœ… Map/Public/menu_data.json íŒŒì¼ì„ git add í•©ë‹ˆë‹¤.
          git add Map/Public/menu_data.json
          
          git commit -m "chore(data): Auto-update menu data [skip ci]" || echo "No changes to commit"
          git push

name: ğŸ—“ï¸ Update Menu Data

on:
  # ìˆ˜ë™ ì‹¤í–‰ì„ ìœ„í•œ íŠ¸ë¦¬ê±°
  workflow_dispatch:
  # âœ… ì´ë¯¸ì§€ íŒŒì¼(JPG/PNG) ì—…ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰ë˜ë„ë¡ ìˆ˜ì •
  push:
    paths:
      - 'backend/**.jpg' 
      - 'backend/**.png'
  # ì„ íƒ ì‚¬í•­: ì£¼ê¸°ì  ìŠ¤ì¼€ì¤„ ì‹¤í–‰ (ë§¤ì¼ KST 11:00 AM)
  schedule:
    - cron: "0 2 * * *" # UTC 02:00

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      # 1. ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
      - name: 1. Checkout repository
        uses: actions/checkout@v4

      # 2. Python í™˜ê²½ ì„¤ì •
      - name: 2. Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      # 3. í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
      - name: 3. Install Dependencies
        run: pip install google-genai pillow

     
      - name: 4. Run OCR script
        run: |
          # âœ… Map í´ë”ë¡œ ì´ë™í•˜ì—¬ ê²½ë¡œ ì¶©ëŒ ë¬¸ì œë¥¼ ìš°íšŒí•©ë‹ˆë‹¤.
          cd Map 
          python backend/ocr_importer_local.py
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}

      # 5. ë³€ê²½ëœ JSON íŒŒì¼ ì»¤ë°‹ ë° í‘¸ì‹œ
      - name: 5. Commit & Push JSON update
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@github.com"
          
          # âœ… Map í´ë” ì•ˆì˜ Public/ ê²½ë¡œë¥¼ git add í•©ë‹ˆë‹¤.
          git add Map/Public/menu_data.json
          
          git commit -m "chore(data): Auto-update menu data [skip ci]" || echo "No changes to commit"
          git push

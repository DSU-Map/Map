name: ğŸ—“ï¸ Update Menu Data (Final Attempt)

on:
  workflow_dispatch:
  push:
    paths:
      # âœ… Map/backend/ ê²½ë¡œ ëŒ€ì‹  ê°€ì¥ ë‹¨ìˆœí•œ ê²½ë¡œë¡œ íŠ¸ë¦¬ê±°
      - 'backend/**' 
  schedule:
    - cron: "0 2 * * *" 

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      # 1. ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
      - name: 1. Checkout repository
        uses: actions/checkout@v4
        # path ì„¤ì • ì œê±°

      # 2. Python í™˜ê²½ ì„¤ì •
      - name: 2. Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      # 3. í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
      - name: 3. Install Dependencies
        run: pip install google-genai pillow

      # 4. ğŸš€ OCR ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ 
      - name: 4. Run OCR script
        run: |
          # âœ… Map/ í´ë”ë¥¼ ëª…ì‹œí•˜ì§€ ì•Šê³ , ë°”ë¡œ 'backend/' ê²½ë¡œë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤í–‰
          # -> Runnerê°€ Map/ ê²½ë¡œë¥¼ ì•Œì•„ì„œ ë¶™ì—¬ì£¼ê¸¸ ê¸°ëŒ€í•©ë‹ˆë‹¤.
          python backend/ocr_importer_local.py
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}

      # 5. ë³€ê²½ëœ JSON íŒŒì¼ ì»¤ë°‹ ë° í‘¸ì‹œ
      - name: 5. Commit & Push JSON update
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@github.com"
          
          # âœ… Map/Public/menu_data.json íŒŒì¼ì„ git add í•©ë‹ˆë‹¤.
          git add Map/Public/menu_data.json
          
          git commit -m "chore(data): Auto-update menu data [skip ci]" || echo "No changes to commit"
          git push
